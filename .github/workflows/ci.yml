# CI workflow for FOTEI
# This GitHub Actions workflow runs on pushes and pull requests to the
# `feature/colab-integration` branch (and any other branch). It performs:
#   1️⃣ Linting with ruff (Python linter) and black (code formatter).
#   2️⃣ Unit‑test execution (pytest) – we will add a minimal test suite later.
#   3️⃣ Type checking with mypy.
#   4️⃣ Ensures that the new modules (`semantic_tagging.py` and
#      `batch_tagging.py`) import correctly and that the Gemini client can be
#      imported (the test will mock the external library).
#
# The workflow is deliberately lightweight because the Gemini API key is not
# available in CI; the tests mock the client.
#
# To enable the workflow, place this file at `.github/workflows/ci.yml` in the
# repository.
#
# ---------------------------------------------------------------------------
# File: .github/workflows/ci.yml
# ---------------------------------------------------------------------------

name: CI

on:
  push:
    branches: ["*"]
  pull_request:
    branches: ["*"]

jobs:
  lint-and-test:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install ruff black pytest mypy
          # Install the Gemini client as an optional dependency – it will be
          # mocked in tests, so we install a lightweight stub.
          pip install google-generativeai || true

      - name: Lint with ruff
        run: ruff src

      - name: Format check with black
        run: black --check src

      - name: Type check with mypy
        run: mypy src

      - name: Run tests
        run: pytest -q

      - name: Upload test results (optional)
        if: always()
        uses: actions/upload-artifact@v4
        with:
          name: test-results
          path: .
